# vim: filetype=bash

#!/bin/sh

prefix=/usr/local
debugsym=true
profilesym=false

for arg in "$@"; do
    case "$arg" in
    --prefix=*)
        prefix=`echo $arg | sed 's/--prefix=//'`
        ;;

    --enable-debug)
        debugsym=true;;
    --disable-debug)
        debugsym=false;;

    --enable-profile)
        profilesym=true;;
    --disable-profile)
        profilesym=false;;

    --help)
        echo 'usage: ./configure [options]'
        echo 'options:'
        echo '  --prefix=<path>: installation prefix'
        echo '  --enable-debug: include debug symbols'
        echo '  --disable-debug: do not include debug symbols'
        echo '  --enable-profile: include profile symbols'
        echo '  --disable-profile: do not include profile symbols'
        echo 'all invalid options are silently ignored'
        exit 0
        ;;
    esac
done

# Check if libzip is installed
# FIXME: There are some issues here: this requires gcc, echo and a unix.like environment. What about icc, clang etc.? :-(
have_libzip=`echo "#include <zip.h>" | gcc -c -o /dev/null -Werror -xc - > /dev/null 2>/dev/null && echo "True" || echo "False"`
echo "zip.h found: $have_libzip"
if [ "$have_libzip" != "True" ]; then
    echo "WARNING: libzip library not found!"
    echo "libzip is highly recommended and was not found on this system. Please install the libzip packet(s) for your system."
    exit
fi 

echo 'generating Makefile ...'
echo "PREFIX = $prefix" >Makefile
if $debugsym; then
    echo 'dbg = -g' >>Makefile
fi
if $profilesym; then
    echo 'profile = -pg' >>Makefile
fi
cat Makefile.in >>Makefile
echo 'configuration complete, type make to build.'
